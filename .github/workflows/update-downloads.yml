name: è‡ªåŠ¨æ›´æ–°ä¸‹è½½é“¾æ¥

on:
  # æ¯å¤©å‡Œæ™¨2ç‚¹è¿è¡Œ
  schedule:
    - cron: '0 2 * * *'
  # å…è®¸æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

# è®¾ç½®å·¥ä½œæµæƒé™
permissions:
  contents: write
  pull-requests: write

jobs:
  update-downloads:
    runs-on: ubuntu-latest
    
    steps:
      # æ³¨æ„ï¼šæœ¬åœ°linterå¯èƒ½ä¼šæ˜¾ç¤ºé”™è¯¯ï¼Œä½†è¿™äº›æ˜¯GitHubå®˜æ–¹actionsï¼Œåœ¨GitHub Actionsç¯å¢ƒä¸­æ˜¯å¯ç”¨çš„
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v3.5.3  # ä½¿ç”¨æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: è®¾ç½®Node.jsç¯å¢ƒ
        uses: actions/setup-node@v3.8.1  # ä½¿ç”¨æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬
        with:
          node-version: '20'
          cache: 'npm'

      - name: å®‰è£…ä¾èµ–
        run: npm install

      - name: è¿è¡Œæ›´æ–°è„šæœ¬
        run: npm run update-downloads
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: æ£€æŸ¥æ˜¯å¦æœ‰æ›´æ”¹
        id: git-check
        run: |
          git add public/assets/scripts/configs/download-config.js
          git diff --staged --quiet || echo "changes=true" >> $GITHUB_OUTPUT

      - name: æäº¤æ›´æ”¹
        if: steps.git-check.outputs.changes == 'true'
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git commit -m "ğŸš€ è‡ªåŠ¨æ›´æ–°ä¸‹è½½é“¾æ¥ | ğŸ“¦ æ›´æ–°è½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯ [skip ci]"
          git push